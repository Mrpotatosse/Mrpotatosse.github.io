<html>
	<head>
	<head>
	<body>
		<div>
			<label for="ip-input">ip:</label>
			<input id="ip-input" type="text"/>
		</div>
		<div>
			<label for="subnet-input">subnet:</label>
			<input id="subnet-input" type="number" />
		</div>
		<div>
			<button id="ip-button-submit">submit</button>
		</div>
		<div>
			<span id="output"></span>
		</div>
	</body>
</html>
<script>
	const ipInput = document.getElementById("ip-input");
	const ipButtonSubmit = document.getElementById("ip-button-submit");
	const output = document.getElementById("output");
	const subnetInput = document.getElementById("subnet-input");
	
	function getNByte(bits) {
		if(bits > 8) return 1 + getNByte(bits - 8);
		return 1;
	}
	
	function getPas(bits) {
		if (bits > 8) return getPas(bits - 8);
		return 0x0100 >> bits;
	}
	
	function getMask(bits) {
		const first = 0b10000000_00000000_00000000_00000000;
		let mask = 0;
		for (let i = 0; i < bits; i++) {
			mask = mask + (first >>> i)
		}

		const f4 = 0b1111_1111;
		const f3 = f4 << 8;
		const f2 = f3 << 8;
		const f1 = f2 << 8;

		return [(mask & f1) >>> 24, (mask & f2) >>> 16, (mask & f3) >>> 8, mask & f4]
	}
	
	function getNetwork(ip, bits) {
		const nb = getNByte(bits);
		const pas = getPas(bits);
		return ip.map((v, i) => {
			if(i === nb - 1) {
				const p = Math.floor(v / pas);
				return pas * p;
			}
			if(i >= nb) {
				return 0;
			}
			return v;
		});
	}
	
	function getBroadcast(ip, bits) {
		const nb = getNByte(bits);
		const pas = getPas(bits);
		return ip.map((v, i) => {
			if(i === nb - 1) {
				const p = Math.floor(v / pas);
				return (pas * (p + 1)) - 1;
			}
			if(i >= nb) {
				return 255;
			}
			return v;
		});
	}
	
	function getSubnet(ip, bits, size) {
		const ips = [];
		const nbits = bits + Math.ceil(Math.log2(size));
		const nb = getNByte(nbits);
		const pas = getPas(nbits);
		
		for(let i = 0; i < size; i++) {
			ips.push(ip.map((v, j, arr) => {
				const nv = (v + (i * pas));
				if (j === nb - 2) {
					return v + Math.floor(nv / 256);
				}
				if (j === nb - 1) {
					return nv % 256;  
				}
				return v;
			}));
		}
	
		return {
			ips,
			bits: nbits
		}
	}
	
	function submit() {
		const ipValue = ipInput.value;
		const arr = ipValue.split("/");
		
		const bits = Number.parseInt(arr[1]);
		const ip = arr[0].split(".").map((v) => Number.parseInt(v));
		const mask = getMask(bits);
		const network = getNetwork(ip, bits);
		const broadcast = getBroadcast(ip, bits);
		
		const subnetValue = subnetInput.value;
		const subnetSize = Number.parseInt(subnetValue);
		const subnet = getSubnet(network, bits, subnetSize);

		output.innerText = `
@ip: ${ip.join(".")}
mask: ${mask.join(".")}
@rso: ${network.join(".")}
@bdt: ${broadcast.join(".")}

subnets: 
${subnet.ips.map(v => `@ip: ${v.join(".")}/${subnet.bits}`).join("\n")}
`;
	}
	
	ipButtonSubmit.addEventListener("click", submit);
</script>
